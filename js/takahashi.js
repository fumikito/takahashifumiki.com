var Floom=new Class({Implements:[Events,Options],options:{prefix:"floom_",amount:24,animation:70,interval:8000,axis:"vertical",progressbar:true,captions:true,captionsFxOut:$empty,captionsFxIn:$empty,slidesBase:$empty,sliceFxIn:$empty,onSlideChange:$empty,onPreload:$empty},initialize:function(c,b,a){this.setOptions(a);c=$(c);this.slides=this.driver(b);this.wrapper={el:c,width:c.getSize().x,height:c.getSize().y};this.slices={els:[],width:(this.options.axis=="vertical"?this.wrapper.width/this.options.amount:this.wrapper.width).toInt(),height:(this.options.axis=="vertical"?this.wrapper.height:this.wrapper.height/this.options.amount).toInt()};this.current={slide:0,overlay:0,counter:0};this.preloadImgs=[];this.createStructure()},driver:function(a){if($type(a[0]).contains("element")){this.slidesEl=[];a.each(function(b){this.slidesEl.push({image:b.get("src"),caption:b.get("title")})},this);a.destroy().empty();a=this.slidesEl}return a},horizontal:function(){return{"background-position":"0 -"+(this.slices.height*this.current.counter)+"px"}},vertical:function(){return{"background-position":"-"+(this.slices.width*this.current.counter)+"px 0"}},createProgressbar:function(){this.progressbar=new Element("div",{"class":this.options.prefix+"progressbar",morph:{duration:this.options.interval-(this.options.animation*this.options.amount),transition:"linear"}});this.progressbar.inject(this.wrapper.el)},createCaptions:function(){this.captions=new Element("div",{"class":this.options.prefix+"caption",html:"caption",styles:{opacity:0}});this.captions.inject(this.wrapper.el)},createStructure:function(){this.container=new Element("div",{"class":this.options.prefix+"container",styles:{height:this.wrapper.height,width:this.wrapper.width}});this.container.inject(this.wrapper.el);if(this.options.progressbar){this.createProgressbar()}if(this.options.captions){this.createCaptions()}this.preload()},createBlinds:function(a){this.current.counter=a;this.slices.els[a]=new Element("div",{"class":this.options.prefix+"slice "+this.options.prefix+this.options.axis,tween:{duration:this.options.animation*4},styles:$merge({opacity:0,width:this.slices.width,height:this.slices.height,"background-image":"url("+this.options.slidesBase+this.slides[this.current.slide].image+")"},this[this.options.axis]())}).inject(this.container);this.slices.els[a].morph($merge({opacity:1},this.options.sliceFxIn));if(a==this.options.amount-1){this.step.delay(this.options.animation,this)}},preload:function(){this.slides.each(function(a){this.preloadImgs.push(this.options.slidesBase+a.image)},this);new Asset.images(this.preloadImgs,{onComplete:this.onPreload.bind(this)})},onPreload:function(){this.animateBlinds().periodical(this.options.interval,this);this.fireEvent("onPreload",this.slides[this.current.slide])},animateBlinds:function(){this.current.slide++;if(this.current.slide==this.slides.length-1){this.current.slide=0}for(var a=0;a<this.options.amount;a++){this.createBlinds.delay(this.options.animation*a,this,a)}if(this.options.progressbar){this.progressbar.fade("out")}if(this.options.captions){this.captions.morph($merge({opacity:0},this.options.captionsFxOut))}return this.animateBlinds},step:function(){this.container.set("styles",{"background-image":"url("+this.options.slidesBase+this.slides[this.current.slide].image+")"});this.slices.els.each(function(b){b.destroy()});if(this.options.progressbar){var a=this.container.getSize().x-(this.progressbar.getStyles("margin-left")["margin-left"].toInt()*2);this.progressbar.morph({width:[0,a]});this.progressbar.fade("in")}if(this.options.captions){this.captions.set("html",this.slides[this.current.slide].caption);this.captions.morph($merge({opacity:1},this.options.captionsFxIn))}this.fireEvent("onSlideChange",this.slides[this.current.slide])}});Element.implement({floom:function(b,a){return new Floom(this,b,a)}});var MultiBox=new Class({getOptions:function(){return{initialWidth:250,initialHeight:250,container:document.body,overlay:false,useOverlay:false,contentColor:"#FFF",showNumbers:true,showControls:true,descClassName:false,descMinWidth:400,descMaxWidth:600,movieWidth:400,movieHeight:300,offset:{x:0,y:0},fixedTop:false,path:"files/",_onOpen:$empty,_onClose:$empty,openFromLink:true}},initialize:function(b,a){this.setOptions(this.getOptions(),a);this.openClosePos={};this.timer=0;this.contentToLoad={};this.index=0;this.opened=false;this.contentObj={};this.containerDefaults={};this.createArray=[];if(this.options.useOverlay){this.overlay=new Overlay({container:this.options.container});this.overlay.setOnClick(this.close.bind(this))}else{this.overlay=this.options.overlay;if(this.overlay){this.overlay.setOnClick(this.close.bind(this))}}this.content=$$("."+b);if(this.options.descClassName){this.descriptions=$$("."+this.options.descClassName);this.descriptions.each(function(c){c.setStyle("display","none")})}this.container=new Element("div").addClass("MultiBoxContainer").injectInside(this.options.container);this.iframe=new Element("iframe").setProperties({id:"multiBoxIframe",name:"mulitBoxIframe",src:"javascript:void(0);",frameborder:0,scrolling:"no"}).setStyles({position:"absolute",top:-20,left:-20,filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)",opacity:0}).inject(this.container);this.box=new Element("div").addClass("MultiBoxContent").inject(this.container);this.closeButton=new Element("div").addClass("MultiBoxClose").inject(this.container).addEvent("click",this.close.bind(this));this.controlsContainer=new Element("div").addClass("MultiBoxControlsContainer").inject(this.container);this.controls=new Element("div").addClass("MultiBoxControls").inject(this.controlsContainer);this.previousButton=new Element("div").addClass("MultiBoxPrevious").inject(this.controls).addEvent("click",this.previous.bind(this));this.nextButton=new Element("div").addClass("MultiBoxNext").inject(this.controls).addEvent("click",this.next.bind(this));this.title=new Element("div").addClass("MultiBoxTitle").inject(this.controls);this.titleMargin=this.title.getStyle("margin-left");this.number=new Element("div").addClass("MultiBoxNumber").inject(this.controls);this.description=new Element("div").addClass("MultiBoxDescription").inject(this.controls);if(this.content.length==1){this.title.setStyles({"margin-left":0});this.description.setStyles({"margin-left":0});this.previousButton.setStyle("display","none");this.nextButton.setStyle("display","none");this.number.setStyle("display","none")}new Element("div").setStyle("clear","both").inject(this.controls);this.content.each(function(d,c){d.index=c;d.addEvent("click",function(f){new Event(f).stop();this.open(d)}.bind(this));if(d.href.indexOf("#")>-1){d.content=$(d.href.substr(d.href.indexOf("#")+1));if(d.content){d.content.setStyle("display","none")}}},this);this.containerEffects=new Fx.Morph(this.container,{duration:400,transition:Fx.Transitions.Sine.easeInOut});this.iframeEffects=new Fx.Morph(this.iframe,{duration:400,transition:Fx.Transitions.Sine.easeInOut});this.controlEffects=new Fx.Morph(this.controlsContainer,{duration:300,transition:Fx.Transitions.Sine.easeInOut});this.reset()},setContentType:function(b){var d=b.href.substr(b.href.lastIndexOf(".")+1).toLowerCase();var c={};if($chk(b.rel)){var a=b.rel.split(",");a.each(function(f){var e=f.split(":");c[e[0]]=e[1]})}if(c.type!=undefined){d=c.type}this.contentObj={};this.contentObj.url=b.href;this.contentObj.src=b.href;this.contentObj.xH=0;if(c.width){this.contentObj.width=c.width}else{this.contentObj.width=this.options.movieWidth}if(c.height){this.contentObj.height=c.height}else{this.contentObj.height=this.options.movieHeight}if(c.panel){this.panelPosition=c.panel}else{this.panelPosition=this.options.panel}switch(d){case"jpg":case"image":case"gif":case"png":this.type="image";break;case"swf":this.type="flash";break;case"youtube":this.type="youtube";break;case"flv":this.type="flashVideo";this.contentObj.xH=70;break;case"mov":this.type="quicktime";break;case"wmv":this.type="windowsMedia";break;case"rv":case"rm":case"rmvb":this.type="real";break;case"mp3":this.type="flashMp3";this.contentObj.width=320;this.contentObj.height=70;break;case"element":this.type="htmlelement";this.elementContent=b.content;this.elementContent.setStyles({display:"block",opacity:0});if(c.width){this.contentObj.width=c.width}else{if(this.elementContent.getStyle("width")!="auto"){this.contentObj.width=this.elementContent.getStyle("width")}}if(c.height){this.contentObj.height=c.height}else{this.contentObj.height=this.elementContent.getSize().y}this.elementContent.setStyles({display:"none",opacity:1});break;default:this.type="iframe";if(c.ajax){this.type="ajax"}break}},reset:function(){this.container.setStyles({opacity:0,display:"none"});this.controlsContainer.setStyles({height:0});this.removeContent();this.previousButton.removeClass("MultiBoxButtonDisabled");this.nextButton.removeClass("MultiBoxButtonDisabled");this.opened=false},getOpenClosePos:function(d){if(this.options.openFromLink){if(d.getFirst()){var a=d.getFirst().getCoordinates().width-(this.container.getStyle("border").toInt()*2);if(a<0){a=0}var c=d.getFirst().getCoordinates().height-(this.container.getStyle("border").toInt()*2);if(c<0){c=0}this.openClosePos={width:a,height:c,top:d.getFirst().getCoordinates().top,left:d.getFirst().getCoordinates().left}}else{var a=d.getCoordinates().width-(this.container.getStyle("border").toInt()*2);if(a<0){a=0}var c=d.getCoordinates().height-(this.container.getStyle("border").toInt()*2);if(c<0){c=0}this.openClosePos={width:a,height:c,top:d.getCoordinates().top,left:d.getCoordinates().left}}}else{var b=this.container.getStyle("border").toInt();if(this.options.fixedTop){var e=this.options.fixedTop}else{var e=((window.getHeight()/2)-(this.options.initialHeight/2)-b)+this.options.offset.y+window.getScroll().y}this.openClosePos={width:this.options.initialWidth,height:this.options.initialHeight,top:e,left:((window.getWidth()/2)-(this.options.initialWidth/2)-b)+this.options.offset.x}}return this.openClosePos},open:function(b){this.options._onOpen();this.index=this.content.indexOf(b);this.openId=b.getProperty("id");var a=this.container.getStyle("border").toInt();if(!this.opened){this.opened=true;if(this.overlay){this.overlay.show()}this.container.setStyles(this.getOpenClosePos(b));this.container.setStyles({opacity:0,display:"block"});if(this.options.fixedTop){var c=this.options.fixedTop}else{var c=((window.getHeight()/2)-(this.options.initialHeight/2)-a)+this.options.offset.y+window.getScroll().y}this.containerEffects.start({width:this.options.initialWidth,height:this.options.initialHeight,top:c,left:((window.getWidth()/2)-(this.options.initialWidth/2)-a)+this.options.offset.x,opacity:[0,1]});this.load(this.index)}else{if(this.options.showControls){this.hideControls()}this.getOpenClosePos(this.content[this.index]);this.timer=this.hideContent.bind(this).delay(500);this.timer=this.load.pass(this.index,this).delay(1100)}},create:function(e){if(this.createArray.contains(e.url)){var d=this.createArray.indexOf(e.url);var c=this.content[d]}else{var g="mbDirect_"+$time();var b=[];if(e.type){b.push("type:"+e.type)}if(e.width){b.push("width:"+e.width)}if(e.height){b.push("height:"+e.height)}var c=new Element("a",{href:e.url,id:g,title:e.title||"",rel:b.join(",")});var f=new Element("div",{"class":g,html:e.description||""});this.createArray.push(e.url);this.content.push(c);var d=this.content.length-1;if(this.options.descClassName){this.descriptions.include(f)}}this.open(c)},getContent:function(a){this.setContentType(this.content[a]);var b=false;if(this.options.descClassName){this.descriptions.each(function(d,c){if(d.hasClass(this.openId)){b=d.clone()}},this)}this.contentToLoad={title:this.content[a].title||"&nbsp;",desc:b,number:a+1}},close:function(){if(this.overlay){this.overlay.hide()}if(this.options.showControls){this.hideControls()}this.hideContent();this.containerEffects.cancel();this.zoomOut.bind(this).delay(500);this.options._onClose()},zoomOut:function(){this.iframeEffects.start({width:this.openClosePos.width,height:this.openClosePos.height});this.containerEffects.start({width:this.openClosePos.width,height:this.openClosePos.height,top:this.openClosePos.top,left:this.openClosePos.left,opacity:0});this.reset.bind(this).delay(500)},load:function(b){this.box.addClass("MultiBoxLoading");this.getContent(b);if(this.type=="image"){var a=this.contentObj.xH;this.contentObj=new Asset.image(this.content[b].href,{onload:this.resize.bind(this)});this.contentObj.xH=a}else{this.resize()}},resize:function(){if(this.tempSRC!=this.contentObj.src){var a=this.container.getStyle("border").toInt();if(this.options.fixedTop){var c=this.options.fixedTop}else{var c=((window.getHeight()/2)-((Number(this.contentObj.height)+this.contentObj.xH)/2)-a+window.getScrollTop())+this.options.offset.y}var b=((window.getWidth()/2)-(this.contentObj.width.toInt()/2)-a)+this.options.offset.x;if(c<0){c=0}if(b<0){b=0}this.containerEffects.cancel();this.containerEffects.start({width:this.contentObj.width,height:Number(this.contentObj.height)+this.contentObj.xH,top:c,left:b,opacity:1});this.iframeEffects.start({width:Number(this.contentObj.width)+(a*2),height:Number(this.contentObj.height)+this.contentObj.xH+(a*2)});this.timer=this.showContent.bind(this).delay(500);this.tempSRC=this.contentObj.src}},showContent:function(){this.tempSRC="";this.box.removeClass("MultiBoxLoading");this.removeContent();this.contentContainer=new Element("div").setProperties({id:"MultiBoxContentContainer"}).setStyles({opacity:0,width:this.contentObj.width+"px",height:(Number(this.contentObj.height)+this.contentObj.xH)+"px"}).injectInside(this.box);if(this.type=="image"){this.contentObj.injectInside(this.contentContainer)}else{if(this.type=="iframe"){new Element("iframe").setProperties({id:"iFrame"+new Date().getTime(),width:this.contentObj.width,height:this.contentObj.height,src:this.contentObj.url,frameborder:0,scrolling:"auto"}).injectInside(this.contentContainer)}else{if(this.type=="htmlelement"){this.contentContainer.setStyle("overflow","auto");this.elementContentParent=this.elementContent.getParent();this.elementContent.setStyle("display","block").injectInside(this.contentContainer)}else{if(this.type=="ajax"){new Request.HTML({update:$("MultiBoxContentContainer"),autoCancel:true}).get(this.contentObj.url)}else{var a=this.createEmbedObject().injectInside(this.contentContainer);if(this.str!=""){$("MultiBoxMediaObject").innerHTML=this.str}}}}}this.contentEffects=new Fx.Morph(this.contentContainer,{duration:500,transition:Fx.Transitions.linear});this.contentEffects.start({opacity:1});this.title.set("html",this.contentToLoad.title);if(this.content.length>1){this.number.set("html",this.contentToLoad.number+" of "+this.content.length)}else{this.number.set("html","")}if(this.options.descClassName){if(this.description.getFirst()){this.description.getFirst().destroy()}if(this.contentToLoad.desc){this.contentToLoad.desc.inject(this.description).setStyles({display:"block"})}}if(this.options.showControls){if(this.contentToLoad.title!="&nbsp;"||this.content.length>1){this.timer=this.showControls.bind(this).delay(800)}}},hideContent:function(){this.box.addClass("MultiBoxLoading");this.contentEffects.start({opacity:0});this.removeContent.bind(this).delay(500)},removeContent:function(){if($("MultiBoxMediaObject")){$("MultiBoxMediaObject").empty();$("MultiBoxMediaObject").destroy()}if($("MultiBoxContentContainer")){if(this.type=="htmlelement"){this.elementContent.setStyle("display","none").inject(this.elementContentParent)}$("MultiBoxContentContainer").destroy()}},showControls:function(){this.clicked=false;if(this.container.getStyle("height")!="auto"){this.containerDefaults.height=this.container.getStyle("height");this.containerDefaults.backgroundColor=this.options.contentColor}this.container.setStyles({height:"auto"});if(this.content.length>1){this.previousButton.setStyle("visibility","visible");this.nextButton.setStyle("visibility","visible");this.title.setStyle("margin-left",this.titleMargin);if(this.contentToLoad.number==1){this.previousButton.addClass("MultiBoxPreviousDisabled")}else{this.previousButton.removeClass("MultiBoxPreviousDisabled")}if(this.contentToLoad.number==this.content.length){this.nextButton.addClass("MultiBoxNextDisabled")}else{this.nextButton.removeClass("MultiBoxNextDisabled")}}else{this.previousButton.setStyle("visibility","hidden");this.nextButton.setStyle("visibility","hidden");this.title.setStyle("margin-left",0)}this.controlEffects.start({height:this.controls.getCoordinates().height});this.iframeEffects.start({height:this.iframe.getStyle("height").toInt()+this.controls.getStyle("height").toInt()});if(this.overlay){this.overlay.position()}},hideControls:function(a){this.iframeEffects.start({height:this.iframe.getStyle("height").toInt()-this.controls.getStyle("height").toInt()});this.controlEffects.start({height:0}).chain(function(){this.container.setStyles(this.containerDefaults)}.bind(this))},showThumbnails:function(){},next:function(){if(this.index<this.content.length-1){this.index++;this.openId=this.content[this.index].getProperty("id");if(this.options.showControls){this.hideControls()}this.getOpenClosePos(this.content[this.index]);this.timer=this.hideContent.bind(this).delay(500);this.timer=this.load.pass(this.index,this).delay(1100)}},previous:function(){if(this.index>0){this.index--;this.openId=this.content[this.index].getProperty("id");if(this.options.showControls){this.hideControls()}this.getOpenClosePos(this.content[this.index]);this.timer=this.hideContent.bind(this).delay(500);this.timer=this.load.pass(this.index,this).delay(1000)}},createEmbedObject:function(){if(this.type=="flash"){var a=this.contentObj.url;var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'" ';this.str+='title="MultiBoxMedia">';this.str+='<param name="movie" value="'+a+'" />';this.str+='<param name="quality" value="high" />';this.str+='<embed src="'+a+'" ';this.str+='quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'"></embed>';this.str+="</object>"}if(this.type=="youtube"){var a=this.contentObj.url;var b=a.indexOf("v=")+2;var c=a.indexOf("&",b);a=a.substring(b,c);a="http://www.youtube.com/v/"+a+"&h1=en&fs=1";var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'" ';this.str+='title="MultiBoxMedia">';this.str+='<param name="movie" value="'+a+'" />';this.str+='<param name="quality" value="high" />';this.str+='<param name="allowFullScreen" value="true"></param>';this.str+='<embed src="'+a+'" ';this.str+='quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" ';this.str+='allowfullscreen="true" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'"></embed>';this.str+="</object>"}if(this.type=="flashVideo"){var a=this.contentObj.url;var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+(Number(this.contentObj.height)+this.contentObj.xH)+'" ';this.str+='title="MultiBoxMedia">';this.str+='<param name="movie" value="'+this.options.path+'flvplayer.swf" />';this.str+='<param name="quality" value="high" />';this.str+='<param name="salign" value="TL" />';this.str+='<param name="scale" value="noScale" />';this.str+='<param name="FlashVars" value="path='+a+'" />';this.str+='<embed src="'+this.options.path+'flvplayer.swf" ';this.str+='quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+(Number(this.contentObj.height)+this.contentObj.xH)+'"';this.str+='salign="TL" ';this.str+='scale="noScale" ';this.str+='FlashVars="path='+a+'"';this.str+="></embed>";this.str+="</object>"}if(this.type=="flashMp3"){var a=this.contentObj.url;var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'" ';this.str+='title="MultiBoxMedia">';this.str+='<param name="movie" value="'+this.options.path+'mp3player.swf" />';this.str+='<param name="quality" value="high" />';this.str+='<param name="salign" value="TL" />';this.str+='<param name="scale" value="noScale" />';this.str+='<param name="FlashVars" value="path='+a+'" />';this.str+='<embed src="'+this.options.path+'mp3player.swf" ';this.str+='quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" ';this.str+='width="'+this.contentObj.width+'" ';this.str+='height="'+this.contentObj.height+'"';this.str+='salign="TL" ';this.str+='scale="noScale" ';this.str+='FlashVars="path='+a+'"';this.str+="></embed>";this.str+="</object>"}if(this.type=="quicktime"){var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object  type="video/quicktime" classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab"';this.str+=' width="'+this.contentObj.width+'" height="'+this.contentObj.height+'">';this.str+='<param name="src" value="'+this.contentObj.url+'" />';this.str+='<param name="autoplay" value="true" />';this.str+='<param name="controller" value="true" />';this.str+='<param name="enablejavascript" value="true" />';this.str+='<embed src="'+this.contentObj.url+'" autoplay="true" pluginspage="http://www.apple.com/quicktime/download/" width="'+this.contentObj.width+'" height="'+this.contentObj.height+'"></embed>';this.str+="<object/>"}if(this.type=="windowsMedia"){var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object  type="application/x-oleobject" classid="CLSID:22D6f312-B0F6-11D0-94AB-0080C74C7E95" codebase="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=6,4,7,1112"';this.str+=' width="'+this.contentObj.width+'" height="'+this.contentObj.height+'">';this.str+='<param name="filename" value="'+this.contentObj.url+'" />';this.str+='<param name="Showcontrols" value="true" />';this.str+='<param name="autoStart" value="true" />';this.str+='<embed type="application/x-mplayer2" src="'+this.contentObj.url+'" Showcontrols="true" autoStart="true" width="'+this.contentObj.width+'" height="'+this.contentObj.height+'"></embed>';this.str+="<object/>"}if(this.type=="real"){var d=new Element("div").setProperties({id:"MultiBoxMediaObject"});this.str='<object classid="clsid:CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA"';this.str+=' width="'+this.contentObj.width+'" height="'+this.contentObj.height+'">';this.str+='<param name="src" value="'+this.contentObj.url+'" />';this.str+='<param name="controls" value="ImageWindow" />';this.str+='<param name="autostart" value="true" />';this.str+='<embed src="'+this.contentObj.url+'" controls="ImageWindow" autostart="true" width="'+this.contentObj.width+'" height="'+this.contentObj.height+'"></embed>';this.str+="<object/>"}return d}});MultiBox.implement(new Options);MultiBox.implement(new Events);var Overlay=new Class({getOptions:function(){return{colour:"#000",opacity:0.7,zIndex:1,container:document.body,_onClick:$empty}},initialize:function(a){this.setOptions(this.getOptions(),a);this.options.container=$(this.options.container);this.container=new Element("div").setProperty("id","MooverlayContainer").setStyles({position:"absolute",left:"0px",top:"0px",width:"100%",display:"none",zIndex:this.options.zIndex}).injectInside(this.options.container);this.iframe=new Element("iframe").setProperties({id:"MooverlayIframe",name:"MooverlayIframe",src:"javascript:void(0);",frameborder:0,scrolling:"no"}).setStyles({position:"absolute",top:0,left:0,width:"100%",height:"100%",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)",opacity:0,zIndex:1}).injectInside(this.container);this.overlay=new Element("div").setProperty("id","Mooverlay").setStyles({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",zIndex:2,backgroundColor:this.options.colour}).injectInside(this.container);if(this.options._onClick){this.container.addEvent("click",function(){this.options._onClick.call(this)}.bind(this))}this.container.fade("hide");this.position();window.addEvent("resize",this.position.bind(this))},reset:function(){this.container.dispose();this.position();this.container.inject(this.options.container)},setOnClick:function(a){this.container.addEvent("click",a)},position:function(){if(this.options.container==document.body){var a=window.getScrollHeight()+"px";this.container.setStyles({top:"0px",height:a})}else{var b=this.options.container.getCoordinates();this.container.setStyles({top:b.top+"px",height:b.height+"px",left:b.left+"px",width:b.width+"px"})}},show:function(){this.container.setStyle("display","block");this.container.fade(this.options.opacity)},hide:function(){this.container.fade("out")}});Overlay.implement(new Options);var Home=new Class({tategaki:null,initialize:function(){if(!Browser.Engine.trident){this.tategaki=new Tategakizer();new Fx.Tween(this.tategaki.devide(document.getElement(".desc"),"。")).start("color","#4D4945");$$("#column1 ol a,#column1 h2,#column2 h3").each(function(b,a){this.tategaki.devide(b,"")},this);$$("#column1 h3 a,#column2 h4 a").each(function(b,a){this.tategaki.make(b,15)},this);$$("a.cat_top").each(function(b,a){this.tategaki.make(b,15)},this)}this.adjustHeight();document.getElement(".desc").toggleClass("toggle");this.makeSlide();this.hideIndicator()},adjustHeight:function(){var a=0;var b=setInterval(function(){var c=$$("#column2 .conBox");c.each(function(f,e){var d=f.getSize().y;if(d>a){a=d}});if(a>0){c.each(function(e,d){e.setStyle("height",a)});clearInterval(b)}},500)},makeSlide:function(){$("floom").floom($$("#floom img"),{slidesBase:"",sliceFxIn:{top:20},axis:"vertical"})},hideIndicator:function(){$("indicator").fade("out");setTimeout(function(){$("indicator").dispose()},500)}});window.addEvent("domready",function(c){$$("#footer li a").each(function(f,e){var g=new Fx.Morph(f,{link:"cancel"});f.addEvent("mouseenter",(function(){this.start({color:["#00A0E9"],backgroundColor:["#cee8f4"],paddingLeft:[10]})}).bindWithEvent(g));f.addEvent("mouseleave",(function(){this.start({color:["#cee8f4"],backgroundColor:["#00A0E9"],paddingLeft:[0]})}).bindWithEvent(g))});var b=$("s");if(b){b.addEvents({focus:function(f){f.target.value=""},blur:function(f){if(b.value==""){b.value=String.fromCharCode(8811)+"検索語句"}}})}if($$("body.home").length==1){var d=new Home()}if($$("body.n_single").length==1||$$("body.t_single").length==1){var a=new Single()}});var Single=new Class({theme_dir:"",initialize:function(){$$("script").each(function(h,g){if(h.src.match(/takahashi_single\.js/)){this.theme_dir=h.src.split("js/takahashi_single")[0];return false}},this);var a=document.getElement("body");if(a.hasClass("n_single")&&a.hasClass("post")){window.addEvent("resize",this.windowAdjust)}this.codeFormatter();var d=$$(".entry a[href$=jpg]");var c=$$(".entry a[href$=jpeg]");var b=$$(".entry a[href$=gif]");var e=$$(".entry a[href$=png]");var f=d.concat(c,b,e);if(f.length>0){this.make_slimBox(f)}this.linkFormat();if($("fumiki_flash_container")){this.flash_embed()}new SmoothScroll();if($("sale-timer")){this.sale_timer()}},windowAdjust:function(){var a=$$(".n_single #wrapper")[0];if(a){if(window.getSize().x>1200){a.setStyles({width:"1200px",margin:"0 auto"})}else{if(window.getSize().x<900){a.setStyles({width:"900px",margin:"0 auto"})}else{a.setStyles({width:"auto",magrgin:"0 50px"})}}}var b=$("footer");if(b.getParent().getSize().x>1200){b.setStyles({width:"1160px",padding:"0 20px 0",margin:"0 auto"})}else{if(b.getParent().getSize().x<900){b.setStyles({width:"860px",padding:"10px 20px 0",margin:"0 auto"});b.getParent().setStyle("width","900px")}else{b.setStyles({width:"auto",padding:"10px 20px 0",margin:"0 auto"});b.getParent().setStyle("width","auto")}}},codeFormatter:function(){var a=$$('.entry pre[class=""]');a.each(function(c,b){if(c.getProperty()){var e=c.get("text").replace(/</g,"&lt;")}e=e.replace(/>/g,"&gt;");e=e.replace(/"(.*?)"/g,'<span class="quote">&quot;$1&quot;</span>');e=e.replace(/'(.*?)'/g,'<span class="quote">&lsquo;$1&rsquo;</span>');e=e.replace(/\/\/(.*)\n/g,'<span class="notation">//$1</span>\n');e=e.split("\n");var d='<table cellpadding="0" cellspacing="0">';e.each(function(h,g){if(g%2==1){d+='<tr class="even">'}else{d+="<tr>"}d+="<th>"+(g+1)+"</th><td>"+h+"</tr></td>"});d+="</table>";var f=new Element("div");f.toggleClass("code-format");f.set("html",d);f.inject(c,"before");c.dispose()})},hatena:function(){var b=this.theme_dir+"web-app/?mode=hatena";var a=new Request({url:b,method:"get",link:"cancel",onSuccess:function(c,g){var h=$(g).getElements("item");for(i=0;i<5;i++){var f=h[i].getElement("title").get("text");var d=h[i].getElement("link").get("text");var e='<li><a href="'+d+'">'+f+"</a></li>"}},onFailure:function(c){}});a.send()},google:function(){var b=this.theme_dir+"web-app/?mode=gblog";var a=new Request.JSON({url:b,method:"get",link:"cancel",onSuccess:function(c,d){for(i=0;i<5;i++){}},onFailure:function(c){}});a.send()},make_slimBox:function(a){a.each(function(d,c){d.addClass("multibox");if(d.getElement("img")){d.title=d.getElement("img").alt}});var b=new MultiBox("multibox",{useOverlay:true})},flash_embed:function(){var a=$("fumiki_flash_container");var c=a.getElement("span").get("text");c=c.split("::");var b={};b.container=a;if(c[1]){b.width=c[1]}if(c[2]){b.height=c[2]}new Swiff(c[0],b)},linkFormat:function(){$$(".entry>p>a").each(function(b,a){if(!b.getElement("img")){var c=b.href.match(/\.[a-z]+$/);if(c){switch(c[0]){case".zip":case".gzip":b.addClass("zip");break;case".pdf":b.addClass("pdf");break;case".epub":b.addClass("epub");break}}if(b.href&&!b.href.match(/^#/)&&!b.href.match(/^http:\/\/takahashifumiki\.com/)){b.addClass("external")}}})},sale_timer:function(){var b=$("sale-timer");var a=b.getElement("input").value;var c=function(e,g,f){var j=a.toInt()-Math.floor(new Date().getTime()/1000);if(j>0){var h=(j>3600*100)?Math.floor(j/3600):("0"+Math.floor(j/3600)).slice(-2);e.set("text",h);g.set("text",("0"+Math.floor(j%3600/60)).slice(-2));f.set("text",("0"+j%60).slice(-2))}else{$clear(d);e.set("text","00");g.set("text","00");f.set("text","00");window.location.reload()}};var d=c.periodical(1000,a,b.getElements("span"))}});var Tategakizer=new Class({Implements:[Options],options:{},initialize:function(a){},devide:function(c,d){var a=c.get("text");var b=(d)?a.split(d):[a];c.empty();if(b[b.length-1].clean().length==0){b.pop()}b.each((function(g,f){var h=(g!="")?g+d:g;var e=this.line(h,"p");if(e.get("text")){e.inject(c)}}),this);return c.addClass("tategaki")},make:function(e,d){var a=this.applyTcy(e.get("text")).split(":::");var c=[];var b=0;a.each(function(h,g){if(b%d==0){c.push(new Element("p"))}if(h.match(/^autoAscii/)){new Element("span").set("text",h.replace(/^autoAscii/,"")).addClass("ascii").inject(c[b])}else{if(h.match(/^autoTcy/)){new Element("span").set("text",h.replace(/^autoTcy/,"")).addClass("horizontal").inject(c[b])}else{var f=h.split("");f.each(function(k,j){this.wrap(k,"span").inject(c[b])},this)}}},this);$$(".ascii").each(function(h,g){var k=h.get("text").split("");for(var j=0,f=k.length;j<f;j++){new Element("span").addClass("ascii").set("text",k[j]).inject(h,"before")}h.dispose()});e.empty().addClass("tategaki");c.each(function(g,f){g.inject(e)})},line:function(c,b){var a=new Element(b);c.trim().split("").each((function(e,d){this.wrap(e,"span").inject(a)}),this);return a},wrap:function(c,a){var b=new Element(a).set("text",c);return this.filter(b)},split:function(a,b){return a.split(b)},filter:function(a){if(this.shibu.contains(a.get("text"))){a.addClass("shibu")}if(this.nibu.contains(a.get("text"))){a.addClass("nibu")}if(this.tcy.contains(a.get("text"))){a.addClass("tcy")}return a},apply:function(){},applyTcy:function(b){var a=b.replace(/(^|[^ -~])([ -~]{4,})([^ -~]|$)/g,"$1:::autoAscii$2:::$3").replace(/(:::[^ -~])([ -~]{4,})([^ -~]|$)/,"$1:::autoAscii$2:::$3").replace(/:::autoAscii([0-9]+):::/,"$1").replace(/(^|[^ -~])([ -~][ -~])([^ -~]|$)/g,"$1:::autoTcy$2:::$3");return a.replace(/^:::/,"").replace(/:::$/,"")},tcy:["「","」","（","）","：","ー","＝","【","】","〜"],tcy_demi:[],shibu:["。","、"],nibu:["ぁ","ぃ","ぅ","ぇ","ぉ","ゃ","ゅ","ょ","っ","ァ","ィ","ゥ","ェ","ォ","ッ","ャ","ュ","ョ"]});